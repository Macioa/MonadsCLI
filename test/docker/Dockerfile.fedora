FROM fedora:40

ARG GO_VERSION=1.20.13

RUN dnf -y install ca-certificates curl tar gzip \
  && dnf clean all

RUN arch="$(uname -m)" \
  && case "$arch" in \
    x86_64) go_arch="amd64" ;; \
    aarch64|arm64) go_arch="arm64" ;; \
    *) echo "unsupported arch: $arch" && exit 1 ;; \
  esac \
  && curl -fsSL "https://go.dev/dl/go${GO_VERSION}.linux-${go_arch}.tar.gz" \
  | tar -C /usr/local -xz

ENV PATH="/usr/local/go/bin:${PATH}"

WORKDIR /app
COPY . /app

RUN go build -o /usr/local/bin/monadscli ./cmd/monadscli

CMD ["monadscli", "run", "--command", "echo hello from fedora"]
