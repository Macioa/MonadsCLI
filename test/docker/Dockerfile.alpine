FROM alpine:3.19

RUN apk add --no-cache ca-certificates go curl bash python3 py3-pip python3-dev nodejs-current npm build-base linux-headers rust cargo tree-sitter tree-sitter-dev \
  && update-ca-certificates \
  && ln -sf /usr/bin/python3 /usr/bin/python

ENV PATH="/usr/local/go/bin:${PATH}"

WORKDIR /app
COPY . /app

RUN go build -o /usr/local/bin/monadscli ./cmd/monadscli

RUN chmod +x /app/test/docker/install-and-verify.sh

CMD ["/app/test/docker/install-and-verify.sh"]
